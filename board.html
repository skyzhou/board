<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>board</title>
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<style>
			html {
				overflow: hidden;
			}
			body {
				background: #ffffff;
				padding: 0px;
				margin: 0px;
				font-size:12px;
			}
			ul, li {
				margin: 0px;
				padding: 0px;
				list-style: none;
			}
			.bar,.menu{
				position: absolute;
				bottom:0px;
				padding:4px;
				border-top:1px solid #EE2C2C;
				background: #EE7621;
			}
			.bar{
				left: 0px;
				z-index: 99;
			}
			.bar li{
				float:left;
				width:50px;
				margin:2px;
				height:25px;
				padding: 2px;
			}
			.bar label{
				color:#ffffff;
				display:inline-block;
				margin-top:5px;
				margin-left:3px;
			}
			.menu{
				right: 0px;
				z-index: 88;
				padding-left:100px;
				
			}
			.menu li{
				float:right;
				margin:2px;
				height:25px;
				padding: 2px;
			}
			.tips{
				position: absolute;
				top:100px;
				left:50%;
				margin-left:-95px;
				width:150px;
				height:80px;
				padding:20px;
				z-index: 77;
				border: 1px solid #FF6347;
				border-radius:10px;
				background: #FF8247;
				text-align:center;
				display:block;
			}
			.tips input{
				padding:6px;
				font-size:14px;
			}
		</style>
		<script type="text/javascript">
			/**
			 * @description 画图主类
			 * @constructor Canvas
			 * @param {Object} elem canvas元素对象
			 */
			var Canvas = function(elem,strokeStyle,fillStyle) {
				var sc = window.screen, scX = sc.width, scY = sc.height;
				elem.width = scX;
				elem.height = scY;

				var c = elem.getContext("2d"), isDraw = false, fn = new Function(), x = 0, y = 0, dx = 0, dy = 0, offset = 0, that = this, ta, 
					hdl = {
						dw : new Function(),
						up : new Function(),
						move : new Function()
					}, shape = "line";

				//默认值
				c.strokeStyle = strokeStyle||'#000000';
				c.fillStyle = fillStyle||'#000000';
				c.lineWidth = "3.0";

				/**
				 * @description 设置属性
				 * @param {String} name 属性key
				 * @param {String} value 熟悉vvalue
				 */
				this.set = function(name, value) {
					if(name == "shape") {
						shape = value;
					} else {
						c[name] = value;
					}
				};
				/**
				 * @description 获取DataURL格式的图片
				 */
				this.get = function() {
					return elem.toDataURL();
				};
				/**
				 * @description 描述各种手指状态应该执行的句柄
				 * @param {String} name 可选值为 dw，按下 up，抬起 move，移动
				 * @param {String} value  执行句柄
				 */
				this.hdl = function(name, value) {
					hdl[name] = value;
				};
				/**
				 * @description 文字书写 已经废弃
				 */
				this.text = function(elem) {
					ta = elem;
				};
				/**
				 * @description 插入头像 未使用
				 */
				this.insert = function(img) {
					c.drawImage(img, x, y);
				};
				/**
				 * @description 设置各种图形，所对应的手指动作句柄
				 */
				this.draw = {
					"line" : function() {
						hdl.move = function() {
							c.lineTo(dx, dy);
							c.stroke();
						}
					},
					"rect" : function() {
						hdl.move = function() {
							c.rect(x, y, dx - x, dy - y);
							c.stroke();
							c.fill();
						}
					},
					"arc" : function() {
						hdl.move = function() {
							c.arc((x + dx) / 2, (y + dy) / 2, Math.sqrt(Math.pow(dx - x, 2) + Math.pow(dy - y, 2)) / 2, 0, Math.PI * 2);
							c.stroke();
							c.fill();
						}
					},
					"dLine" : function() {
						hdl.up = function() {
							c.lineTo(dx, dy);
							c.stroke();
						}
					},
					"text" : function() {
						hdl.dw = function() {
							c.fillText(ta.value, x, y);
						}
					},
					"erase" : function() {
						hdl.dw = function() {
							c.clearRect(x - 8, y - 8, 16, 16);
						};
						hdl.move = function() {
							c.clearRect(dx - 8, dy - 8, 16, 16);
						};
					}
				};
				/**
				 * @description 清除内容
				 */
				this.clear = function() {
					c.clearRect(0, 0, scX, scY);
				};
				/**
				 * @description事件监听
				 */
				elem.addEventListener("touchstart", function(evt) {
					//elem.addEventListener("mousedown",function(evt){

					//初始化
					that.draw[shape]();
					//if(evt.button==0){
					c.beginPath();

					var touch = evt.touches[0];
					x = touch.clientX - offset;
					//+window.pageXOffset;
					y = touch.clientY - offset;
					//+window.pageYOffset;
					c.moveTo(x, y);
					isDraw = true;
					hdl.dw();
					hdl.dw = fn;
					evt.preventDefault();
				}, false);
				elem.addEventListener("touchend", function(evt) {
					//elem.addEventListener("mouseup",function(evt){
					c.closePath();
					isDraw = false;
					hdl.up();
					//执行回调
					hdl.move = fn;
					hdl.up = fn;
					//删除回调
				}, false);
				elem.addEventListener("touchmove", function(evt) {
					//elem.addEventListener("mousemove",function(evt){
					if(isDraw) {
						var touch = evt.touches[0];
						dx = touch.clientX - offset;
						//+window.pageXOffset;
						dy = touch.clientY - offset;
						//+window.pageYOffset;
						hdl.move();
						//执行回调
					}
					evt.preventDefault();
				}, false)
			}
			/*
			 * 页面JS
			 */

			var $ = function(id) {
				return document.getElementById(id);
			};
			var Tool = {
				set : function(shape) {
					Bd.set("shape", shape);

				},
				save : function() {
					window.open(Bd.get());

				},
				text : function(id) {
					Tool.set(id);
					Bd.text($("text_val"));
				},
				color : function(elem, name) {
					var color = elem.value;
					Bd.set(name, color);
				},
				save : function() {
					window.demo.clickOnAndroid("该功能暂不支持");
				}
			};
			var Bd;
			var Start=function(){
				Bd = new Canvas($("canvas"));
				Tool.set("line");
				$('tips').style.display="none";
			}

		</script>
	</head>
	<body>
		
		<div class="canvas">
			<canvas id="canvas">
				Does not support
			</canvas>
		</div>
		<ul class="bar">
			<li>
				<select  onchange="Tool.set(this.value);">
					<option value="line">铅笔</option>
					<option value="arc">圆规</option>
					<option value="rect">方块</option>
					<option value="erase">橡皮</option>
				</select>
			</li>
			<li>
				<select onchange="Bd.set('lineWidth',this.value);">
					<option value="3.0">3.0</option>
					<option value="1.0">1.0</option>
					<option value="2.0">2.0</option>
					<option value="4.0">4.0</option>
					<option value="5.0">5.0</option>
					<option value="6.0">6.0</option>
					<option value="7.0">7.0</option>
				</select>
			</li>
			<li>
				<select  onchange="Tool.color(this,'strokeStyle');">
					<option value="#000000">□黑</option>
					<option value="#FF0000">□红</option>
					<option value="#ff8040">□橙</option>
					<option value="#f8df07">□黄</option>
					<option value="#008080">□绿</option>
					<option value="#0080ff">□蓝</option>
					<option value="#FFFFFF">□白</option>
			</select>
			</li>
			<li>
				<select  onchange="Tool.color(this,'fillStyle');">
					<option value="#000000" >■黑</option>
					<option value="#FF0000" >■红</option>
					<option value="#ff8040" >■橙</option>
					<option value="#f8df07">■黄</option>
					<option value="#008080" >■绿</option>
					<option value="#0080ff" >■蓝</option>
					<option value="#FFFFFF" >■白</option>
				</select>
			</li>
		</ul>
		<ul class="menu">
			<li>
				<input type="button" value="清除" onclick="Bd.clear();"/>
			</li>
		</ul>
		<div class="tips" id="tips">
			<h2>亲，记得分享哦～</h2>
			<div><input type="button" value="开始吧" onclick="Start();"/></div>
		</div>
	</body>
</html>